<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì‹ í˜¸ë“±</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<style>
body { text-align:center; font-family:Arial; margin-top:30px; }
.clock { font-size:22px; margin-bottom:20px; }
.state { font-size:40px; margin-top:30px; }
.count { font-size:70px; }
button { font-size:20px; padding:10px 20px; margin:10px; }
</style>
</head>

<body>

<div class="clock" id="clock"></div>
<div class="state" id="state"></div>
<div class="count" id="time"></div>

<button onclick="setGreen()">ğŸŸ¢ ì´ˆë¡ ì‹œì‘</button>
<button onclick="setRed()">ğŸ”´ ë¹¨ê°• ì‹œì‘</button>

<script>

// â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­
    const firebaseConfig = {
  apiKey: "AIzaSyAxwM-IBryLUHgCkOCFphd2GVhqILAINAk",
  authDomain: "signal-902a9.firebaseapp.com",
  projectId: "signal-902a9",
  storageBucket: "signal-902a9.firebasestorage.app",
  messagingSenderId: "1040774154277",
  appId: "1:1040774154277:web:21c0ca2b2b2e9f6dca17cc"
};
// â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­â­

const firebaseConfig = {
  apiKey: "AIzaSyAxwM-IBryLUHgCkOCFphd2GVhqILAINAk",
  authDomain: "signal-902a9.firebaseapp.com",
  projectId: "signal-902a9",
  storageBucket: "signal-902a9.firebasestorage.app",
  messagingSenderId: "1040774154277",
  appId: "1:1040774154277:web:21c0ca2b2b2e9f6dca17cc"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const PATTERN = [
    { state: "RED", duration: 60 },
    { state: "GREEN", duration: 30 },
    { state: "RED", duration: 20 },
    { state: "GREEN", duration: 30 }
];

const TOTAL = PATTERN.reduce((sum, p) => sum + p.duration, 0);

function updateClock() {
    const now = new Date();
    const seoulTime = now.toLocaleString("ko-KR", {
        timeZone: "Asia/Seoul",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false
    });

    document.getElementById("clock").innerText =
        "ğŸ‡°ğŸ‡· í˜„ì¬ ì‹œê° (ì„œìš¸): " + seoulTime;
}

function setGreen() {
    db.ref("signal/start").set(Math.floor(Date.now() / 1000));
}

function setRed() {
    db.ref("signal/start").set(Math.floor(Date.now() / 1000));
}

db.ref("signal/start").on("value", snapshot => {
    window.startTime = snapshot.val();
});

function updateSignal() {

    if (!window.startTime) return;

    const now = Math.floor(Date.now() / 1000);
    let cycle = (now - window.startTime) % TOTAL;

    let accumulated = 0;

    for (let step of PATTERN) {

        if (cycle < accumulated + step.duration) {

            const remaining = accumulated + step.duration - cycle;

            if (step.state === "GREEN") {
                document.getElementById("state").innerText = "ğŸŸ¢ ì´ˆë¡ë¶ˆ";
            } else {
                document.getElementById("state").innerText = "ğŸ”´ ë¹¨ê°„ë¶ˆ";
            }

            document.getElementById("time").innerText = remaining + "ì´ˆ";
            break;
        }

        accumulated += step.duration;
    }
}

function updateAll() {
    updateClock();
    updateSignal();
}

setInterval(updateAll, 1000);

</script>

</body>
</html>
