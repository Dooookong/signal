<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>전국 신호등 지도 - 시그널 맵</title>
    <script type="module" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: "Pretendard", sans-serif; }
        #map { width: 100%; height: 100vh; }
        
        /* 지도 위 커스텀 오버레이(신호등 팝업) 스타일 */
        .node-popup {
            background: #1a1c1e;
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #333;
            color: white;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            position: relative;
            bottom: 120px; /* 마커 위로 띄우기 */
        }
        .popup-time { font-size: 30px; font-weight: bold; margin: 5px 0; }
        .popup-state { font-size: 12px; }
    </style>
</head>
<body>

    <div id="map"></div>

<script type="module">
    // Firebase 설정 (생략 - 기존 내용 그대로 유지)
    
    // 1. 지도 생성
    const mapContainer = document.getElementById('map');
    const mapOption = { 
        center: new kakao.maps.LatLng(37.5665, 126.9780), // 서울 중심
        level: 3 
    };
    const map = new kakao.maps.Map(mapContainer, mapOption);

    // 2. 신호등 데이터 (나중엔 Firebase에서 가져올 목록)
    const signalNodes = [
        {
            id: "seoul_01",
            name: "시청 앞 교차로",
            latlng: new kakao.maps.LatLng(37.5665, 126.9780),
            pattern: [110, 26.5, 35.5, 26.5]
        }
    ];

    // 3. 마커 및 팝업 표시 함수
    signalNodes.forEach(node => {
        const marker = new kakao.maps.Marker({
            map: map,
            position: node.latlng
        });

        // 커스텀 오버레이 생성 (우리가 만든 신호등 카운트다운을 여기에 삽입)
        const content = `
            <div class="node-popup">
                <div class="popup-state" id="state_${node.id}">연결 중...</div>
                <div class="popup-time" id="time_${node.id}">--</div>
                <div style="font-size:10px; color:#666;">${node.name}</div>
            </div>
        `;

        const overlay = new kakao.maps.CustomOverlay({
            content: content,
            position: node.latlng
        });

        // 마커 클릭 시 팝업 띄우기
        kakao.maps.event.addListener(marker, 'click', () => {
            overlay.setMap(map);
        });
    });

    // 4. 실시간 업데이트 로직 (기존 update 함수를 루프 돌리도록 개량)
    // ... (Firebase에서 startTime 가져와서 각 ID별로 매칭하는 코드)
</script>
</body>
</html>
